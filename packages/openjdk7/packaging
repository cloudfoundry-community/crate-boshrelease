set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

# Detect # of CPUs so make jobs can be parallelized
CPUS=`grep -c ^processor /proc/cpuinfo`

# We grab the latest versions that are in the directory
OPENJDK7_VERSION=`ls -r openjdk7/openjdk* | sed 's/openjdk7\/openjdk-\(.*\)-unofficial-linux-amd64-image\.zip/\1/' | head -1`

# Extract OpenJDK 7 package
echo "Extracting OpenJDK 7 ${OPENJDK7_VERSION}..."
unzip ${BOSH_COMPILE_TARGET}/openjdk7/openjdk-${OPENJDK7_VERSION}-unofficial-linux-amd64-image.zip
if [[ $? != 0 ]] ; then
  echo "Failed extracting OpenJDK 7 ${OPENJDK7_VERSION}"
  exit 1
fi

# Copy OpenJDK 7 package
echo "Copying OpenJDK 7 ${OPENJDK7_VERSION}..."
cp -a ${BOSH_COMPILE_TARGET}/openjdk-${OPENJDK7_VERSION}-unofficial-linux-amd64-image/* ${BOSH_INSTALL_TARGET}/
